### Загрузка

#Скачиваем дистрибутив с офф сайта
https://www.archlinux.org/download/

### Запишем его на флешку

sudo dd if=X of=/dev/sdY

Где X - это название ISO файла, Y - буква диска

Пример: sudo dd if=archlinux-2019.06.01-dual.iso of=/dev/sdb && sync

В Winfows лучше записывать программой Rufus https://rufus.ie

Чтобы избежать ошибок при разметке диска, предварительно перезапишите его нулями, например программой Disks загрузившись с USB в любом дистрибутиве Linux

### Загружаемся с флешки

ВАЖНО!

Если вы ставите с UEFI и при загрузки получаете ошибку “security Boot Fail”, то нужно зайти в BIOS  в разделе установить пароль в разделе Set Supervisor Password и в boot вкладке отключить security Boot см. https://i.imgur.com/jFLlrm0.png

Перед установкой

Установка раскладки клавиатуры

### После загрузки настроим русский язык для удобства работы

loadkeys ru

### Изменим консольный шрифт на тот, который поддерживает кириллицу

setfont cyr-sun16

#### Добавим русскую локаль в систему установки:

В файле /etc/locale.gen раскоментируем строку:

#ru_RU.UTF-8 UTF-8

nano /etc/locale.gen

#### Обновим текущую локаль системы:

locale-gen

export LANG=ru_RU.UTF-8


### Соединение с Интернетом

#### Подключаем проводной интернет

dhcpcd

### Если не знаете название вашего устройства (device), то пишем:

ip link

### Подключение через Wi-fi

iwctl

- station device connect SSID

- #Где SSID = название вашей сети

- #Где device = wlp5s0 или wlan0 (у вас будет свое)

### После этого вам будет предложено ввести пароль

Подробнее https://wiki.archlinux.org/index.php/Iwd#iwctl

### Синхронизация системных часов

timedatectl set-ntp true

### Создание разделов

#Смотрим какие диски есть

- fdisk -l

- lsblk

### Разбиваем диски (для ручной разметки используем fdisk, для псевдографической разбивки можно использовать команду cfdisk)

fdisk /dev/sda

Можно вызвать подсказки нажатием на клавишу “m”

### Разделяем диски (подробно в видео)

Видео, которые могут вам помочь https://www.youtube.com/watch?v=PemucgRrdPk  Ручная разметка дисков начинается на 5:14

Если есть желание использовать файловую систему Btrfs, то стаим вот так https://vk.com/@arch4u-ustanovka-arch-linux-na-btrfs

### Создание разделов с BIOS

\# /boot 100M - выставить флаг boot командой a

\# / 20G

\# swap 1024M

\# /home весь остаток

### Создание разделов с UEFI

- cfdisk /dev/sda

/dev/sda1 - 500M EFI - выставить флаг EFI командой t

/dev/sda2 - 30G root Linux File System

/dev/sda3 - Весь остаток home Linux file System

### Процесс разбивки диска по шагам

См. видео https://vk.cc/7S7OMg

### Создаем MBR таблицу (Для UEFI - GPT командой g)
o

### Создаем новый диск

n

Жмем enter

### Выбираем primary (основной)  или extented (расширенный)

По умолчанию стоит primary (основной) поэтому просто жмем enter

### Выбор номера диска, по умолчанию подставляется следующий номер

Просто жмем enter

### Запрос на первый сектор диска

Просто жмем enter

### Запрос на последний сектор диска (Ставим + и объем памяти. Пример: +100M)

+100Ml

*Повторяем все шаги снова для всех нужных разделов диска*

<mark>**(LEGACY) Для /boot не забываем указать **a** и поставить 1 для установки его загрузочным**</mark>

<mark>**(UEFI) Для efi не забываем указать, что это efi раздел t и поставить 1**</mark>

Как все разметили не забываем все записать командой w

В итоге можете проверить, что у вас получилось командой fdisk -l or lsblk

Должно получиться примерно так:

Legacy разметка  http://i.imgur.com/pgej0Nt.png

UEFI разметка https://i.imgur.com/O7Yn0MK.png

### Форматирование и монтирование разделов

### Разделы с BIOS

mkfs.ext2  /dev/sda1 -L boot

mkfs.ext4  /dev/sda2 -L root

mkswap /dev/sda3 -L swap

mkfs.ext4  /dev/sda4 -L home

### Монтируем

/mount /dev/sda2 /mnt

### Создаем директорию boot и home в mnt

mkdir /mnt/{boot,home}

### Монтируем boot

mount /dev/sda1 /mnt/boot

### Монтируем swap

swapon /dev/sda3

### Монтируем /home

mount /dev/sda4 /mnt/home

### Разделы с UEFI

### Форматирование дисков

mkfs.fat -F32 /dev/sda1

mkfs.ext4  /dev/sda2

mkfs.ext4  /dev/sda3

### Монтирование дисков

mount /dev/sda2 /mnt

mkdir /mnt/home

mkdir -p /mnt/boot/efi

mount /dev/sda1 /mnt/boot/efi

mount /dev/sda3 /mnt/home

Выбираем зеркало для pacman
Для более быстрой загрузки пакетов настроим зеркала. Поставим российское зеркало Яндекса выше всех остальных:

nano /etc/pacman.d/mirrorlist

И впишем эту строку вверх:

Server = http://mirror.yandex.ru/archlinux/$repo/os/$arch

### Установка пакетов

### Установим базовые пакеты системы.

Дополнительно сюда можем включить необходимые пакеты для установки.

- pacstrap -i /mnt base base-devel grub zsh vim git

После выполнения команды и выбора всех пакетов загрузятся последние версии необходимых пакетов.

Важно: если ведется установка по Wi-Fi, то необходимо установить пакеты netctl, dialog и wpa_supplicant:

pacstrap -i /mnt netctl dialog wpa_supplicant


### Установка пакета GRUB в систему

- arch-chroot /mnt pacman -S grub

### Если используется EFI, то установим efibootmgr:

- arch-chroot /mnt pacman -S efibootmgr grub-efi-x86_64

Если устанавливаем 32-х битную систему, то используем пакет grub-efi-i386.

### Первичная настройка системы

### Сгенерируем fstab, для этого используем следующую команду

- genfstab -p /mnt >> /mnt/etc/fstab

И добавим в файл запись для временного файлового хранилища tmpfs (Предназначена для монтирования файловой системы, но размещается в ОЗУ вместо физического диска.

Подобная конструкция является RAM диском.):

tmpfs	/tmp	tmpfs	defaults,noatime,mode=1777 0 0

### Перейдём в установленную систему

arch-chroot /mnt /bin/bash

#### Добавим русскую локаль в систему

В файле /etc/locale.gen раскомментируем строку 

- # en_US.UTF-8 UTF-8 

и строку 

- # ru_RU.UTF-8 UTF-8

or

- echo -e "en_US.UTF-8 UTF-8\n ru_RU.UTF-8 UTF-8" >> /etc/locale.gen

### Указываем язык системы

- echo 'LANG="ru_RU.UTF-8"' > /etc/locale.conf

### Указываем keymap для console + прописываем шрифт

echo 'KEYMAP=ru' >> /etc/vconsole.conf

echo 'FONT=cyr-sun16' >> /etc/vconsole.conf

nano /etc/locale.gen

#### Обновим текущую локаль системы

locale-gen

### Настроим часы

ln -sf /usr/share/zoneinfo/Asia/Petropavlovsk-Kamchatsky /etc/localtime

hwclock --systohc --utc

### Зададим хостнейм (Прописываем имя компьютера)

echo arch > /etc/hostname

## Изменим пароль root

passwd

### Добавим нового пользователя

useradd -m -g users -G audio,games,lp,optical,power,scanner,storage,video,wheel -s /bin/bash jenit

passwd jenit

Если планируется использовать zsh, то заменим /bin/bash на /bin/zsh

Если терзают сомнения на этот счет, то почитать подробнее можно на хабре.

#### Добавим русскую локаль в консоль

В /etc/mkinitcpio.conf, в разделе HOOKS, должен быть прописан хук keymap.
В разделе MODULES нужно прописать свой драйвер видеокарты: i915 для Intel, radeon для AMD, nouveau для Nvidia.

Если производили установку LVM с шифрованием, то также добавим ext4 в MODULES и encrypt и lvm2 в HOOKS до filesystems.

Создадим загрузочный RAM диск
mkinitcpio -p linux
Установим загрузчик (для BIOS)
grub-install /dev/sda
Если действовали по мануаула с LVM и шифрованием, то необходимо отредактировать строчку GRUB_CMDLINE_LINUX в файле /etc/default/grub:

GRUB_CMDLINE_LINUX="cryptdevice=/dev/sdX2:luks:allow-discards"
grub-mkconfig -o /boot/grub/grub.cfg
Установим загрузчик (для EFI)
grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=grub
Обновим grub.cfg
grub-mkconfig -o /boot/grub/grub.cfg
Внимание: если при создании grub.cfg были ошибки, то попробуйте добавить GRUB_DISABLE_SUBMENU=y в /etc/default/grub.

В случае если посыпятся ошибки вида “failed to connect to lvmetad arch”, можно сильно не пугаться, работать все будет, но для достижения полного дзена я попробую найти решение позже.

Выйдем из установленной системы:

exit
Отмонтируем ранее монтируемые разделы:

umount -R /mnt
И перезагрузим систему.

reboot

### Первичная настройка системы

Сгенерируем fstab, для этого используем следующую команду
genfstab -p /mnt >> /mnt/etc/fstab
И добавим в файл запись для временного файлового хранилища tmpfs (Предназначена для монтирования файловой системы, но размещается в ОЗУ вместо физического диска. Подобная конструкция является RAM диском.):

tmpfs	/tmp	tmpfs	defaults,noatime,mode=1777 0 0
Перейдём в установленную систему
arch-chroot /mnt /bin/bash
Добавим русскую локаль в систему
В файле /etc/locale.gen раскомментируем строку #en_US.UTF-8 UTF-8 и строку #ru_RU.UTF-8 UTF-8

nano /etc/locale.gen
Обновим текущую локаль системы
locale-gen
Настроим часы
ln -s /usr/share/zoneinfo/Asia/Petropavlovsk-Kamchatsky /etc/localtime
hwclock --systohc --utc
Зададим хостнейм
echo arch > /etc/hostname
Изменим пароль root
passwd
Добавим нового пользователя
useradd -m -g users -G audio,games,lp,optical,power,scanner,storage,video,wheel -s /bin/bash jenit
passwd jenit
Если планируется использовать zsh, то заменим /bin/bash на /bin/zsh
Если терзают сомнения на этот счет, то почитать подробнее можно на хабре.

Добавим русскую локаль в консоль
В /etc/mkinitcpio.conf, в разделе HOOKS, должен быть прописан хук keymap.
В разделе MODULES нужно прописать свой драйвер видеокарты: i915 для Intel, radeon для AMD, nouveau для Nvidia.

Если производили установку LVM с шифрованием, то также добавим ext4 в MODULES и encrypt и lvm2 в HOOKS до filesystems.

#### Создадим загрузочный RAM диск

mkinitcpio -p linux

#### Установим загрузчик (для BIOS)

grub-install /dev/sda

Если действовали по мануаула с LVM и шифрованием, то необходимо отредактировать строчку GRUB_CMDLINE_LINUX в файле /etc/default/grub:

GRUB_CMDLINE_LINUX="cryptdevice=/dev/sdX2:luks:allow-discards"
grub-mkconfig -o /boot/grub/grub.cfg

#### Установим загрузчик (для EFI)

grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=grub

#### Обновим grub.cfg

grub-mkconfig -o /boot/grub/grub.cfg

Внимание: если при создании grub.cfg были ошибки, то попробуйте добавить GRUB_DISABLE_SUBMENU=y в /etc/default/grub.

В случае если посыпятся ошибки вида “failed to connect to lvmetad arch”, можно сильно не пугаться, работать все будет, но для достижения полного дзена я попробую найти решение позже.

Выйдем из установленной системы:

exit

Отмонтируем ранее монтируемые разделы:

umount -R /mnt

И перезагрузим систему.

reboot

### Настройка системы

Входим в систему под root-пользователем и выполняем необходимые действия по настройке, если они не были выполнены ранее.

#### Изменим хостнейм

hostnamectl set-hostname arch

#### Установим время

timedatectl set-timezone Asia/Petropavlovsk-Kamchatsky

#### Выполняем локализацию системы

localectl set-keymap ru

setfont cyr-sun16

localectl set-locale LANG="ru_RU.UTF-8"

export LANG=ru_RU.UTF-8

#### Добавим строку:

FONT=cyr-sun16 в /etc/vconsole.conf.

echo 'FONT=cyr-sun16' >> /etc/vconsole.conf

#### Обновим загрузочный RAM диск

mkinitcpio -p linux

Обновим grub.cfg (для локализации):

grub-mkconfig -o /boot/grub/grub.cfg

Настроим pacman (только для x86_64):

nano /etc/pacman.conf

Для работы 32-битных приложений в 64-битной системе необходимо раскомментировать репозиторий multilib:

[multilib]
Include = /etc/pacman.d/mirrorlist

#### Отключаем IPv6

Для этого создадим новый файл /etc/sysctl.d/10-ipv6.conf с содержимым:

net.ipv6.conf.all.disable_ipv6 = 1

Добавим пользователя (если это не было выполнено ранее) и сразу поместим его в необходимые нам группы:

useradd -m -g users -G audio,games,lp,optical,power,scanner,storage,video,wheel -s /bin/bash myusername

Установим ему пароль
passwd myusername
Изменим ему информацию GECOS
chfn myusername
Настройка сети
Для проводной сети
Добавим службу в автозапуск:

systemctl enable dhcpcd
Запустим службу:

systemctl start dhcpcd
Для беспроводной сети
wifi-menu
Обновим базы данных пакетов:

pacman -Syy
Обновим все пакеты:

pacman -Su
Поставим и настроим sudo

pacman -S sudo
В файле /etc/sudoers раскомментируем строку # %wheel ALL=(ALL) ALL
Теперь мы можем использовать sudo для выполнения команд администратора.
Теперь выйдем из root пользователя с помощью команды exit и авторизуемся под пользователем, которого создали.

### Установка графического окружение

#### Установим Х (иксы)

sudo pacman -S xorg-server xorg-xinit xorg-server-utils mesa xterm
(если используется тачпад или тачскрин, то установим xf86-input-synaptics)

Установим драйвер для видеокарты:
Пакеты lib32-* нужно устанавливать только на x86_64 системы.

Intel:

sudo pacman -S xf86-video-intel lib32-intel-dri
Nvidia:

sudo pacman -S xf86-video-nouveau lib32-nouveau-dri
AMD:

sudo pacman -S xf86-video-ati lib32-ati-dri
Если вы устанавливаете систему на виртуальную машину:

sudo pacman -S xf86-video-vesa
Xfce + SDDM
Приступим к установке и настройке графического окружения Xfce с менеджером входа SDDM:

sudo pacman -S xfce4 xfce4-goodies sddm
Добавим SDDM в демоны
sudo systemctl enable sddm.service
Шрифты
Рекомендую установить следующие шрифты:

sudo pacman -S ttf-liberation ttf-dejavu opendesktop-fonts ttf-bitstream-vera ttf-arphic-ukai ttf-arphic-uming ttf-hanazono
Теперь можно перезагрузить систему командой

sudo systemctl reboot
Если все было выполнено правильно и без ошибок, то получаем готовую рабочую систему Arch Linux с Xfce на борту.

Важно: если у вас не вводятся символы в поле ввода, то попробуйте изменить раскладку с помощью комбинации клавиш: левый shift + правый shift. Чтобы установить английскую раскладку по умолчанию откройте файл /etc/X11/xorg.conf.d/00-keyboard.conf и в строке Option «XkbLayout» «ru,us» поменяйте ru и us местами.
После перезагрузки и первом входе в систему, выберите пункт настроек по умолчанию, затем я советую зайти в Меню приложений -> Настройки -> Внешний вид -> Шрифты и выбрать любимый шрифт, я предпочитаю Helvetica. После этого добавьте на панель элемент раскладки клавиатуры и настройте его.

Установим необходимые пакеты для работы
Pacman — это отличный пакетный менеджер, который намного удобнее apt-get из семейства Debian систем. Начнем с того что он безо всяких aptitude может самостоятельно заниматься поиском, установкой, удалением пакетов, удовлетворением зависимостей, синхронизацией репозиториев и обновлением системы, имея при этом довольно простой и логичны консольный интерфейс. Пример нескольких команд:

pacman -S foo # установить пакет foo
pacman -S --asdeps foo # установить пакет foo как зависимость
pacman -Sy # синхронизировать репозитории
pacman -Su # обновить систему
pacman -Syu # синхронизировать репозитории и обновить систему.
pacman -Syu foo # синхронизировать репозитории, обновить систему и установить пакет foo

Для Archlinux вы можете найти любой софт, который вы можете найти вообще для linux. Если вы не найдете какой-то пакет в официальном репозитории, вы наверняка это сделаете в Arch User Repository. Там находятся пакеты опубликованные и сопровождаемые пользователями Archlinux. Там находятся 53 тысячи пакетов против 37,5 тысяч у Debian.

Пакет, с помощью которого GRUB сможет определять все установленные ОС при генерации конфига:

sudo pacman -S os-prober
Браузеры:

sudo pacman -S firefox firefox-i18n-ru chromium opera
Мессенджеры:

sudo pacman -S pidgin skype
Торрент-клиент:

sudo pacman -S transmission-gtk transmission-cli
Графика:

sudo pacman -S gimp pinta gpicview djview4
Офис:

sudo pacman -S libreoffice libreoffice-ru
Мультимедиа:

sudo pacman -S audacity deadbeef smplayer
FTP-клиент:

sudo pacman -S filezilla
Разработка:

sudo pacman -S geany apache mariadb phpmyadmin php php-apache php-pgsql php-sqlite php-mcrypt php-gd
Система:

sudo pacman -S gparted unetbootin
Инструменты:

sudo pacman -S p7zip unrar
Игры:

sudo pacman -S steam mari0
Мышь в терминале
Иногда приходится работать в терминале, а не его эмуляторе. И с некоторыми программами, например Midnight Commander, там будет удобнее работать с мышью. Чтобы использовать мышь в терминале достаточно установить пакет gpm.

sudo pacman -S gpm
Автодополнение
Автодополнение — это очень удобная фича терминала bash. Кнопкой Tab можно существенно облегчить и ускорить ввод команд. Однако такая возможность не предоставляется для таких программ как sudo, pacman и некоторых других. Чтобы исправить эту несправедливость достаточно установить пакет bash-completion.

sudo pacman -S bash-completion

